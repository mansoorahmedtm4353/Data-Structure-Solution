#include <iostream>
#include <string>
using namespace std;

struct Student {
    string name;
    int id;
    Student* next;
    Student* prev;
    Student(string n, int i) : name(n), id(i), next(nullptr), prev(nullptr) {}
};

class TShirtQueue {
    Student* front;
    Student* rear;
    int count;
    
public:
    TShirtQueue() : front(nullptr), rear(nullptr), count(0) {}
    
    void addStudent(string name, int id) {
        Student* newStudent = new Student(name, id);
        if (!rear) {
            front = rear = newStudent;
        } else {
            rear->next = newStudent;
            newStudent->prev = rear;
            rear = newStudent;
        }
        count++;
        cout << "✓ " << name << " joined queue. Position: " << count << endl;
    }
    
    void serveStudent() {
        if (!front) {
            cout << "Queue empty!" << endl;
            return;
        }
        cout << "🎉 " << front->name << " got T-shirt!" << endl;
        Student* temp = front;
        front = front->next;
        if (front) front->prev = nullptr;
        else rear = nullptr;
        delete temp;
        count--;
    }
    
    void removeStudent(int id) {
        Student* current = front;
        while (current && current->id != id) {
            current = current->next;
        }
        if (!current) {
            cout << "Student not found!" << endl;
            return;
        }
        if (current == front) {
            front = front->next;
            if (front) front->prev = nullptr;
            else rear = nullptr;
        } else if (current == rear) {
            rear = rear->prev;
            rear->next = nullptr;
        } else {
            current->prev->next = current->next;
            current->next->prev = current->prev;
        }
        cout << "➡️ " << current->name << " left queue" << endl;
        delete current;
        count--;
    }
    
    void display() {
        if (!front) {
            cout << "Queue empty" << endl;
            return;
        }
        Student* current = front;
        int pos = 1;
        while (current) {
            cout << pos << ". " << current->name << " (ID: " << current->id << ")" << endl;
            current = current->next;
            pos++;
        }
    }
    
    void getCount() {
        cout << "Total students: " << count << endl;
    }
    
    ~TShirtQueue() {
        while (front) {
            Student* temp = front;
            front = front->next;
            delete temp;
        }
    }
};

int main() {
    TShirtQueue q;
    int choice;
    
    do {
        cout << "\n1. Add Student\n2. Serve Student\n3. Remove Student\n4. Display\n5. Count\n6. Exit\nChoice: ";
        cin >> choice;
        
        switch(choice) {
            case 1: {
                string name; int id;
                cout << "Name: "; cin.ignore(); getline(cin, name);
                cout << "ID: "; cin >> id;
                q.addStudent(name, id);
                break;
            }
            case 2: q.serveStudent(); break;
            case 3: {
                int id; cout << "ID to remove: "; cin >> id;
                q.removeStudent(id); break;
            }
            case 4: q.display(); break;
            case 5: q.getCount(); break;
            case 6: cout << "Exiting..."; break;
            default: cout << "Invalid choice!";
        }
    } while(choice != 6);
    
    return 0;
}
